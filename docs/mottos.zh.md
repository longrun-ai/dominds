# 关于代理上下文管理的格言

**TL;DR** 需要实现社会分工，涉及到 AI 代理

## 问题

### 核心问题：AI 代理的认知过载

> LLM 代理很容易迷失方向，远在技术上下文窗口完全填满之前

这个根本问题以几种方式表现：

**1. 上下文碎片化**

- 代理在扩展交互中难以保持连贯的推理线索
- 重要的上下文被累积的对话历史埋没
- 决策质量随着对话长度增加而下降

**2. 注意力稀释**

- 代理将认知资源分散到太多相互竞争的优先事项上
- 相关信息在过去交互的噪音中丢失
- 重点从主要目标转移到次要细节

**3. 心理状态退化**

- 代理的"心理模型"变得混乱和不一致
- 之前的假设即使上下文已改变仍然存在
- 推理路径变得越来越复杂

### 为什么传统解决方案不够用

> 问题从来不是 token 太多，而是方面/关注点太多，它们遭受心理过载，就像人类一样

**Token 容量 vs. 认知容量**

- 尽管有大量的 token 限制，人类式的工作记忆限制仍然适用于 AI 代理
- 推理质量在达到 token 限制之前很久就会下降
- 上下文窗口不是瓶颈——认知带宽才是

**多方面的注意力分散**

- 每个对话轮次添加新的约束、目标和考虑因素
- 代理必须保持对项目范围、用户偏好、技术约束等的认识
- 认知负荷随交互复杂性呈指数级增长

## 解决方案

### 上下文压缩：效果有限

> 上下文压缩？这对代理迷失方向来说是一个相当糟糕的缓解措施

**上下文压缩实际做了什么**

- 将长对话历史总结为压缩形式
- 在减少 token 数量的同时保留关键事实
- 保持过去交互的"悬崖笔记"版本

**压缩方法的局限性**

**1. 信息丢失**

- 关键细微的上下文在摘要中丢失
- 重要决策推理消失
- 相似但不同场景之间的区别变得模糊

**2. 时间上下文问题**

- 压缩丢失推理顺序
- 因果关系变得混乱
- 对某些决策为何做出的理解恶化

**3. 静态 vs. 动态上下文**

- 摘要创建僵化的、过时的快照
- 应该演变的上下文变得石化
- 代理失去对当前动态状态的意识

**4. 累积压缩损失**

- 每轮压缩丢失更多信息
- 每次压缩循环准确度下降
- 最终变得适得其反

**压缩可能帮助的情况**

- 边界清晰的简单任务
- 单域对话
- 需要立即保存 token 的情况

### 主动上下文管理：更好的方法

> 经常改变想法，经常清除脑海中的噪音

**核心哲学：AI 代理的心理卫生**

**1. 有意的上下文重置**

- 定期"认知清理"会话
- 移除过时或无关的信息
- 通过主动修剪保持心智清晰

**2. 以任务为中心的专注架构**

- **中央任务文档**：目标、约束和进度的单一真实来源
- **动态上下文窗口**：时间限制的上下文保留
- **基于优先级的信息过滤**：自动排名上下文相关性

**实现策略：任务文档**

```
TASK_DOC 结构：
├── 主要目标
│   ├── 清晰的目标陈述
│   ├── 成功标准
│   └── 时间线约束
├── 当前上下文
│   ├── 待处理的活跃决策
│   ├── 最近完成的项目
│   └── 立即下一步
├── 约束与注意事项
│   ├── 技术限制
│   ├── 用户偏好
│   └── 资源边界
└── 进度跟踪
    ├── 完成的里程碑
    ├── 阻塞项目
    └── 待解决问题
```

**以任务为中心的架构的好处**

**1. 减少认知负荷**

- 代理专注于一个中央文档
- 无需解析对话历史
- 当前任务和历史上下文之间清晰分离

**2. 提高决策质量**

- 所有决策的一致参考点
- 减少过时上下文的影响
- 更好地与用户意图对齐

**3. 增强适应性**

- 轻松在任务的不同方面之间转换
- 快速切换上下文而不丢失信息
- 跨会话保持连续性线索

### 新靴推理：深入探讨

> 让自己从推理中冥想出来，然后带着想法回到问题

**新靴概念**

**核心原则**：将一个"新鲜的自己"放入同一双靴子（任务上下文）中，干净的思维状态，专注于问题的特定方面。

**在 dominds 中（推荐语法）**

- 新靴推理（FBR）是**常见的**，通常应该通过**瞬态子对话**完成。
- 使用 `@self`（不带 `!tellaskSession`）进行默认的"新靴"会话：隔离一个子问题，回答，然后返回。
- **很少**使用 `@self !tellaskSession <tellaskSession>`，仅当你明确想要一个**可恢复的**长期新靴工作区用于多步骤子问题时。

**传统 vs. 新靴方法**

**传统问题解决：**

```
代理：[现有对话历史，当前状态，任务文档] + 问题
→ 尝试同时解决所有方面
→ 遭受认知过载
→ 产生次优结果
```

**新靴推理：**

```
代理：[干净的心理状态 + 仅任务文档] + 特定子问题
→ 专注于单一方面
→ 应用不带包袱的新鲜推理
→ 产生清晰、有针对性的解决方案
→ 将洞察返回给主代理
```

**新靴机制**

**1. 子问题隔离**

- 将复杂问题分解为特定的、有界的子问题
- 为新鲜推理会话创建详细提示
- 确保子问题真正独立

**2. 新上下文创建**

- 将代理的"心理状态"重置为初始任务理解
- 仅加载必要的任务文档和子问题
- 清除所有累积的对话上下文

**3. 专注推理会话**

- 代理以全部认知带宽攻击子问题
- 没有其他任务方面的干扰
- 纯粹的问题解决，没有上下文污染

**4. 结果整合**

- 从新鲜推理中提取关键洞察
- 将发现整合回主要任务上下文
- 保持洞察和上下文之间的清晰分离

**新靴实现模式**

**模式 1：技术分析模式**

```
触发：需要复杂的技术决策
新鲜会话：
- 加载 task_doc + 技术要求
- 专注："分析可行性并推荐方法"
- 输出：带有推理的清晰技术建议
```

**模式 2：创意构思模式**

```
触发：需要新想法或解决方案
新鲜会话：
- 仅加载 task_doc + 问题陈述
- 专注："在不受约束偏见影响的情况下产生创新方法"
- 输出：带有理由的创意解决方案列表
```

**模式 3：质量保证模式**

```
触发：需要验证当前方法
新鲜会话：
- 加载 task_doc + 当前解决方案尝试
- 专注："识别薄弱环节和改进机会"
- 输出：批判性分析和建议
```

## 高级新靴策略

### 多透镜方法

**概念**：使用不同的"透镜"或视角来检查同一个问题，每个都有新鲜的代理实例。

**实现：**

1. **分析透镜**：纯逻辑和数据驱动分析
2. **创意透镜**：创新和跳出思维定式
3. **批判透镜**：怀疑性评估和假设测试
4. **用户中心透镜**：关注最终用户体验和价值

### 渐进精炼周期

**阶段 1：初始新靴**

- 使用干净的推理生成第一遍解决方案
- 不考虑约束的情况下捕获原始洞察

**阶段 2：约束应用**

- 第二个新鲜会话应用现实世界约束
- 将任务要求与初始洞察整合

**阶段 3：质量验证**

- 第三个新鲜会话评估完整解决方案
- 识别潜在问题和改进机会

### 会话层次：元新鲜推理

**概念**：有时即使是新鲜靴子推理也需要刷新。

**新鲜度级别：**

1. **级别 0**：当前代理状态
2. **级别 1**：干净代理 + task_doc（标准新靴）
3. **级别 2**：完全重置的代理，只有问题陈述
4. **级别 3**：具有不同训练重点的新代理实例

## 最佳实践和指南

### 何时使用新靴推理

**最佳场景：**

- 复杂的多方面问题
- 需要新视角的决策点
- 创意构思需求
- 质量保证和验证
- 突破分析瘫痪

**何时避免：**

- 简单直接的任务
- 需要与先前工作连续性的情况
- 实时交互任务
- 紧急响应场景

### 会话设计原则

**1. 具体性**

- 定义确切的子问题范围
- 每个会话的清晰成功标准
- 避免模糊或开放式提示

**2. 完整性**

- 确保提供所有必要的上下文
- 包括相关的约束和要求
- 提供所需的任何先决知识

**3. 独立性**

- 设计子问题是自包含的
- 最小化会话之间的依赖关系
- 可能时允许并行处理

### 衡量有效性

**关键指标：**

1. **解决方案质量**：新鲜推理是否产生更好的结果？
2. **速度**：洞察生成有多快？
3. **一致性**：结果在会话之间可重现吗？
4. **效率**：与传统方法相比的资源利用

**成功指标：**

- 每个会话产生清晰、可操作的洞察
- 更好地与用户需求对齐
- 减少问题解决时间
- 最终解决方案质量更高

## 实施路线图

### 阶段 1：任务文档基础

1. 设计任务文档模板
2. 实现上下文管理系统
3. 创建上下文清除和重置工具

### 阶段 2：新靴基础设施

1. 开发会话管理系统
2. 创建子问题分解工具
3. 实现结果整合机制

### 阶段 3：高级功能

1. 多透镜推理能力
2. 渐进精炼周期
3. 元新鲜推理选项

### 阶段 4：优化

1. 性能调优和优化
2. 用户界面集成
3. 分析和改进跟踪

## 结论

AI 代理有效性的未来不在于更大的上下文窗口，而在于更智能的上下文管理。通过拥抱主动上下文清除和新靴推理等概念，我们可以构建在扩展交互中保持清晰和专注的代理。

关键洞察是，AI 代理和人类一样，从心理卫生实践中受益匪浅。定期的认知清理和专注的问题解决会话可以显著提高代理推理的质量和效率。

这种方法将管理大量对话上下文的挑战转化为优势，允许代理在保持中央任务文档整体项目连续性的同时，对复杂问题的每个方面带来新鲜、专注的注意力。
